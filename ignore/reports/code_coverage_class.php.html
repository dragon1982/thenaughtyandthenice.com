
                    <html>
                    <head>
                        <title>
                            Xdebug Code Coverage Reports
                        </title>
                    </head>
                    <body>
                    <table border='1'>
                        <tr>
                            <td>Line nr</td>
                            <td>PHP Code</td>
                        </tr>
                
                        <tr>
                            <td>1</td>
                            <td><?php
</td>
                        </tr>
                        
                        <tr>
                            <td>2</td>
                            <td>
</td>
                        </tr>
                        
                        <tr>
                            <td>3</td>
                            <td>class code_coverage
</td>
                        </tr>
                        
                        <tr>
                            <td>4</td>
                            <td>{
</td>
                        </tr>
                        
                        <tr>
                            <td>5</td>
                            <td>    private $analysis_file;
</td>
                        </tr>
                        
                        <tr>
                            <td>6</td>
                            <td>    private $reports_dir;
</td>
                        </tr>
                        
                        <tr>
                            <td>7</td>
                            <td>
</td>
                        </tr>
                        
                        <tr>
                            <td>8</td>
                            <td>    function __construct($analysis_file , $reports_dir)
</td>
                        </tr>
                        
                        <tr>
                            <td>9</td>
                            <td>    {
</td>
                        </tr>
                        
                        <tr BGCOLOR = "grey">
                            <td>10</td>
                            <td>        $this->reports_dir      = $reports_dir;
</td>
                        </tr>
                        
                        <tr BGCOLOR = "grey">
                            <td>11</td>
                            <td>        $this->analysis_file    = $analysis_file;
</td>
                        </tr>
                        
                        <tr BGCOLOR = "grey">
                            <td>12</td>
                            <td>    }
</td>
                        </tr>
                        
                        <tr>
                            <td>13</td>
                            <td>
</td>
                        </tr>
                        
                        <tr>
                            <td>14</td>
                            <td>    public function code_coverage_reports()
</td>
                        </tr>
                        
                        <tr>
                            <td>15</td>
                            <td>    {
</td>
                        </tr>
                        
                        <tr>
                            <td>16</td>
                            <td>        require_once $this->analysis_file;
</td>
                        </tr>
                        
                        <tr>
                            <td>17</td>
                            <td>
</td>
                        </tr>
                        
                        <tr>
                            <td>18</td>
                            <td>        $counter=0;
</td>
                        </tr>
                        
                        <tr>
                            <td>19</td>
                            <td>        foreach($code_coverage_analysis as $file_name=>$lines_executed)
</td>
                        </tr>
                        
                        <tr>
                            <td>20</td>
                            <td>        {
</td>
                        </tr>
                        
                        <tr>
                            <td>21</td>
                            <td>            $file_name_array=explode ('\\',$file_name);
</td>
                        </tr>
                        
                        <tr>
                            <td>22</td>
                            <td>            $file_name_html = $file_name_array[(count($file_name_array)-1)];
</td>
                        </tr>
                        
                        <tr>
                            <td>23</td>
                            <td>
</td>
                        </tr>
                        
                        <tr>
                            <td>24</td>
                            <td>            if($counter != 0)
</td>
                        </tr>
                        
                        <tr>
                            <td>25</td>
                            <td>            {
</td>
                        </tr>
                        
                        <tr>
                            <td>26</td>
                            <td>                $html = "
</td>
                        </tr>
                        
                        <tr>
                            <td>27</td>
                            <td>                    <html>
</td>
                        </tr>
                        
                        <tr>
                            <td>28</td>
                            <td>                    <head>
</td>
                        </tr>
                        
                        <tr>
                            <td>29</td>
                            <td>                        <title>
</td>
                        </tr>
                        
                        <tr>
                            <td>30</td>
                            <td>                            Xdebug Code Coverage Reports
</td>
                        </tr>
                        
                        <tr>
                            <td>31</td>
                            <td>                        </title>
</td>
                        </tr>
                        
                        <tr>
                            <td>32</td>
                            <td>                    </head>
</td>
                        </tr>
                        
                        <tr>
                            <td>33</td>
                            <td>                    <body>
</td>
                        </tr>
                        
                        <tr>
                            <td>34</td>
                            <td>                    <table border='1'>
</td>
                        </tr>
                        
                        <tr>
                            <td>35</td>
                            <td>                        <tr>
</td>
                        </tr>
                        
                        <tr>
                            <td>36</td>
                            <td>                            <td>Line nr</td>
</td>
                        </tr>
                        
                        <tr>
                            <td>37</td>
                            <td>                            <td>PHP Code</td>
</td>
                        </tr>
                        
                        <tr>
                            <td>38</td>
                            <td>                        </tr>
</td>
                        </tr>
                        
                        <tr>
                            <td>39</td>
                            <td>                ";
</td>
                        </tr>
                        
                        <tr>
                            <td>40</td>
                            <td>                $source_code = file($file_name);
</td>
                        </tr>
                        
                        <tr>
                            <td>41</td>
                            <td>                foreach($source_code as $lines=>$source)
</td>
                        </tr>
                        
                        <tr>
                            <td>42</td>
                            <td>                {
</td>
                        </tr>
                        
                        <tr>
                            <td>43</td>
                            <td>                    if(isset($lines_executed[($lines+1)]))
</td>
                        </tr>
                        
                        <tr>
                            <td>44</td>
                            <td>                    {
</td>
                        </tr>
                        
                        <tr>
                            <td>45</td>
                            <td>                        $html.= '
</td>
                        </tr>
                        
                        <tr>
                            <td>46</td>
                            <td>                        <tr BGCOLOR = "grey">
</td>
                        </tr>
                        
                        <tr>
                            <td>47</td>
                            <td>                            <td>'.($lines+1).'</td>
</td>
                        </tr>
                        
                        <tr>
                            <td>48</td>
                            <td>                            <td>'.$source.'</td>
</td>
                        </tr>
                        
                        <tr>
                            <td>49</td>
                            <td>                        </tr>
</td>
                        </tr>
                        
                        <tr>
                            <td>50</td>
                            <td>                        ';
</td>
                        </tr>
                        
                        <tr>
                            <td>51</td>
                            <td>                    }
</td>
                        </tr>
                        
                        <tr>
                            <td>52</td>
                            <td>                    else
</td>
                        </tr>
                        
                        <tr>
                            <td>53</td>
                            <td>                    {
</td>
                        </tr>
                        
                        <tr>
                            <td>54</td>
                            <td>                        $html.= '
</td>
                        </tr>
                        
                        <tr>
                            <td>55</td>
                            <td>                        <tr>
</td>
                        </tr>
                        
                        <tr>
                            <td>56</td>
                            <td>                            <td>'.($lines+1).'</td>
</td>
                        </tr>
                        
                        <tr>
                            <td>57</td>
                            <td>                            <td>'.$source.'</td>
</td>
                        </tr>
                        
                        <tr>
                            <td>58</td>
                            <td>                        </tr>
</td>
                        </tr>
                        
                        <tr>
                            <td>59</td>
                            <td>                        ';
</td>
                        </tr>
                        
                        <tr>
                            <td>60</td>
                            <td>                    }
</td>
                        </tr>
                        
                        <tr>
                            <td>61</td>
                            <td>                }
</td>
                        </tr>
                        
                        <tr>
                            <td>62</td>
                            <td>                $html.= "
</td>
                        </tr>
                        
                        <tr>
                            <td>63</td>
                            <td>                    </body>
</td>
                        </tr>
                        
                        <tr>
                            <td>64</td>
                            <td>                    </html>
</td>
                        </tr>
                        
                        <tr>
                            <td>65</td>
                            <td>                ";
</td>
                        </tr>
                        
                        <tr>
                            <td>66</td>
                            <td>                file_put_contents($this->reports_dir.$file_name_html.".html",$html);
</td>
                        </tr>
                        
                        <tr>
                            <td>67</td>
                            <td>            }
</td>
                        </tr>
                        
                        <tr>
                            <td>68</td>
                            <td>            $counter++;
</td>
                        </tr>
                        
                        <tr>
                            <td>69</td>
                            <td>        }
</td>
                        </tr>
                        
                        <tr>
                            <td>70</td>
                            <td>    }    
</td>
                        </tr>
                        
                        <tr>
                            <td>71</td>
                            <td>    public function code_coverage_analysis_save()
</td>
                        </tr>
                        
                        <tr>
                            <td>72</td>
                            <td>    {
</td>
                        </tr>
                        
                        <tr BGCOLOR = "grey">
                            <td>73</td>
                            <td>        file_put_contents($this->analysis_file,"<?php \$code_coverage_analysis = ".var_export(xdebug_get_code_coverage(),TRUE)." ?>");
</td>
                        </tr>
                        
                        <tr>
                            <td>74</td>
                            <td>        xdebug_stop_code_coverage(true);
</td>
                        </tr>
                        
                        <tr>
                            <td>75</td>
                            <td>    }
</td>
                        </tr>
                        
                        <tr>
                            <td>76</td>
                            <td>}
</td>
                        </tr>
                        
                        <tr>
                            <td>77</td>
                            <td>?></td>
                        </tr>
                        
                    </body>
                    </html>
                